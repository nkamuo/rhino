import{r as $,ap as q,t as J,c2 as N,w as Q,c3 as X,c4 as Y,c5 as Z}from"./index-792b7300.js";var x=new WeakMap,W=0;function ee(r){if(!r.length)return"";for(var n="arg",t=0;t<r.length;++t){var i=void 0;r[t]===null||typeof r[t]!="object"&&typeof r[t]!="function"?typeof r[t]=="string"?i='"'+r[t]+'"':i=String(r[t]):x.has(r[t])?i=x.get(r[t]):(i=W,x.set(r[t],W++)),n+="@"+i}return n}function te(r){if(typeof r=="function")try{r=r()}catch{r=""}return Array.isArray(r)?r=ee(r):r=String(r||""),r}var j=function(){function r(n){n===void 0&&(n=0),this.items=new Map,this.ttl=n}return r.prototype.serializeKey=function(n){return te(n)},r.prototype.get=function(n){var t=this.serializeKey(n);return this.items.get(t)},r.prototype.set=function(n,t,i){var a=this.serializeKey(n),e=i||this.ttl,o=Date.now(),c={data:t,createdAt:o,expiresAt:e?o+e:1/0};this.dispatchExpire(e,c,a),this.items.set(a,c)},r.prototype.dispatchExpire=function(n,t,i){var a=this;n&&setTimeout(function(){var e=Date.now(),o=e>=t.expiresAt;o&&a.delete(i)},n)},r.prototype.delete=function(n){this.items.delete(n)},r}();function re(){return typeof navigator.onLine<"u"?navigator.onLine:!0}function ne(){return typeof document<"u"&&typeof document.visibilityState<"u"?document.visibilityState!=="hidden":!0}var ie=function(r){return fetch(r).then(function(n){return n.json()})};const L={isOnline:re,isDocumentVisible:ne,fetcher:ie};var g=globalThis&&globalThis.__assign||function(){return g=Object.assign||function(r){for(var n,t=1,i=arguments.length;t<i;t++){n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])}return r},g.apply(this,arguments)},R=globalThis&&globalThis.__awaiter||function(r,n,t,i){function a(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function c(l){try{u(i.next(l))}catch(y){o(y)}}function d(l){try{u(i.throw(l))}catch(y){o(y)}}function u(l){l.done?e(l.value):a(l.value).then(c,d)}u((i=i.apply(r,n||[])).next())})},T=globalThis&&globalThis.__generator||function(r,n){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,a,e,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(u){return function(l){return d([u,l])}}function d(u){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,a&&(e=u[0]&2?a.return:u[0]?a.throw||((e=a.return)&&e.call(a),0):a.next)&&!(e=e.call(a,u[1])).done)return e;switch(a=0,e&&(u=[u[0]&2,e.value]),u[0]){case 0:case 1:e=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,a=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!e||u[1]>e[0]&&u[1]<e[3])){t.label=u[1];break}if(u[0]===6&&t.label<e[1]){t.label=e[1],e=u;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(u);break}e[2]&&t.ops.pop(),t.trys.pop();continue}u=n.call(r,t)}catch(l){u=[6,l],a=0}finally{i=e=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},ae=globalThis&&globalThis.__read||function(r,n){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),a,e=[],o;try{for(;(n===void 0||n-- >0)&&!(a=i.next()).done;)e.push(a.value)}catch(c){o={error:c}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return e},ue=globalThis&&globalThis.__spreadArray||function(r,n,t){if(t||arguments.length===2)for(var i=0,a=n.length,e;i<a;i++)(e||!(i in n))&&(e||(e=Array.prototype.slice.call(n,0,i)),e[i]=n[i]);return r.concat(e||Array.prototype.slice.call(n))},P=new j,O=new j,F=new j,G={cache:P,refreshInterval:0,ttl:0,serverTTL:1e3,dedupingInterval:2e3,revalidateOnFocus:!0,revalidateDebounce:0,shouldRetryOnError:!0,errorRetryInterval:5e3,errorRetryCount:5,fetcher:L.fetcher,isOnline:L.isOnline,isDocumentVisible:L.isDocumentVisible};function oe(r,n,t){var i=O.get(r);if(i)i.data.push(n);else{var a=5e3;O.set(r,[n],t>0?t+a:t)}}function le(r,n,t){if(t.isDocumentVisible()&&!(t.errorRetryCount!==void 0&&n>t.errorRetryCount)){var i=Math.min(n||0,t.errorRetryCount),a=i*t.errorRetryInterval;setTimeout(function(){r(null,{errorRetryCount:i+1,shouldRetryOnError:!0})},a)}}var B=function(r,n,t,i){return t===void 0&&(t=P),i===void 0&&(i=G.ttl),R(void 0,void 0,void 0,function(){var a,e,o,c,d,u,l;return T(this,function(y){switch(y.label){case 0:if(!se(n))return[3,5];y.label=1;case 1:return y.trys.push([1,3,,4]),[4,n];case 2:return a=y.sent(),[3,4];case 3:return c=y.sent(),e=c,[3,4];case 4:return[3,6];case 5:a=n,y.label=6;case 6:if(o=!1,d={data:a,error:e,isValidating:o},typeof a<"u")try{t.set(r,d,i)}catch(h){console.error("swrv(mutate): failed to set cache",h)}return u=O.get(r),u&&u.data.length&&(l=u.data.filter(function(h){return h.key===r}),l.forEach(function(h,f){typeof d.data<"u"&&(h.data=d.data),h.error=d.error,h.isValidating=d.isValidating;var m=f===l.length-1;m||delete l[f]}),l=l.filter(Boolean)),[2,d]}})})};function ce(){for(var r=this,n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var i,a,e=g({},G),o=!1,c=!1,d=Z(),u=(d==null?void 0:d.proxy)||d;if(!u)return console.error("Could not get current instance, check to make sure that `useSwrv` is declared in the top level of the setup function."),null;var l=(u==null?void 0:u.$isServer)||!1;n.length>=1&&(i=n[0]),n.length>=2&&(a=n[1]),n.length>2&&(e=g(g({},e),n[2]));var y=l?e.serverTTL:e.ttl,h=typeof i=="function"?i:$(i);typeof a>"u"&&(a=e.fetcher);var f=null;f||(f=q({data:void 0,error:void 0,isValidating:!0,key:null}));var m=function(v,s){return R(r,void 0,void 0,function(){var k,b,E,C,I,M,S,z=this;return T(this,function(D){switch(D.label){case 0:return k=f.data===void 0,b=h.value,b?(E=e.cache.get(b),C=E&&E.data,f.isValidating=!0,C&&(f.data=C.data,f.error=C.error),I=v||a,!I||!e.isDocumentVisible()&&!k||(s==null?void 0:s.forceRevalidate)!==void 0&&!(s!=null&&s.forceRevalidate)?(f.isValidating=!1,[2]):E&&(M=!!(Date.now()-E.createdAt>=e.dedupingInterval||s!=null&&s.forceRevalidate),!M)?(f.isValidating=!1,[2]):(S=function(){return R(z,void 0,void 0,function(){var w,H,_,K;return T(this,function(A){switch(A.label){case 0:return w=F.get(b),w?[3,2]:(H=Array.isArray(b)?b:[b],_=I.apply(void 0,ue([],ae(H),!1)),F.set(b,_,e.dedupingInterval),[4,B(b,_,e.cache,y)]);case 1:return A.sent(),[3,4];case 2:return[4,B(b,w.data,e.cache,y)];case 3:A.sent(),A.label=4;case 4:return f.isValidating=!1,F.delete(b),f.error!==void 0&&(K=!o&&e.shouldRetryOnError&&(s?s.shouldRetryOnError:!0),K&&le(m,s?s.errorRetryCount:1,e)),[2]}})})},C&&e.revalidateDebounce?(setTimeout(function(){return R(z,void 0,void 0,function(){return T(this,function(w){switch(w.label){case 0:return o?[3,2]:[4,S()];case 1:w.sent(),w.label=2;case 2:return[2]}})})},e.revalidateDebounce),[3,3]):[3,1])):[2];case 1:return[4,S()];case 2:D.sent(),D.label=3;case 3:return[2]}})})},V=function(){return R(r,void 0,void 0,function(){return T(this,function(v){return[2,m(null,{shouldRetryOnError:!1})]})})},p=null;J(function(){var v=function(){return R(r,void 0,void 0,function(){return T(this,function(s){switch(s.label){case 0:return!f.error&&e.isOnline()?[4,m()]:[3,2];case 1:return s.sent(),[3,3];case 2:p&&clearTimeout(p),s.label=3;case 3:return e.refreshInterval&&!o&&(p=setTimeout(v,e.refreshInterval)),[2]}})})};e.refreshInterval&&(p=setTimeout(v,e.refreshInterval)),e.revalidateOnFocus&&(document.addEventListener("visibilitychange",V,!1),window.addEventListener("focus",V,!1))}),N(function(){o=!0,p&&clearTimeout(p),e.revalidateOnFocus&&(document.removeEventListener("visibilitychange",V,!1),window.removeEventListener("focus",V,!1));var v=O.get(h.value);v&&(v.data=v.data.filter(function(s){return s!==f}))});try{Q(h,function(v){X(h)||(h.value=v),f.key=v,f.isValidating=!!v,oe(h.value,f,y),!l&&!c&&h.value&&m(),c=!1},{immediate:!0})}catch{}var U=g(g({},Y(f)),{mutate:function(v,s){return m(v,g(g({},s),{forceRevalidate:!0}))}});return U}function se(r){return r!==null&&typeof r=="object"&&typeof r.then=="function"}export{ce as u};
